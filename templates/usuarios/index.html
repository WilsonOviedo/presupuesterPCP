{% extends 'base.html' %}
{% block title %}Gestión de Usuarios{% endblock %}
{% block content %}
  <div class="actions" style="margin-bottom:10px;">
    <a class="button button-secondary" href="{{ url_for('menu') }}">← Volver</a>
    <a class="button" href="{{ url_for('usuarios_nuevo') }}">+ Nuevo Usuario</a>
  </div>
  <h2>Gestión de Usuarios</h2>

  {% if error %}
  <div style="background:#fee; color:#c33; padding:12px; border-radius:6px; margin-bottom:20px; border:1px solid #fcc;">
    {{ error }}
  </div>
  {% endif %}

  {% if mensaje %}
  <div style="background:#d4edda; color:#155724; padding:12px; border-radius:6px; margin-bottom:20px; border:1px solid #c3e6cb;">
    {{ mensaje }}
  </div>
  {% endif %}

  {% if usuarios %}
    <table>
      <tr>
        <th>Usuario</th>
        <th>Nombre Completo</th>
        <th>Email</th>
        <th>Admin</th>
        <th>Estado</th>
        <th>Registro</th>
        <th>Último Acceso</th>
        <th>Acciones</th>
      </tr>
      {% for usuario in usuarios %}
        <tr>
          <td><strong>{{ usuario.username or '<span style="color:#999; font-style:italic;">Pendiente</span>'|safe }}</strong></td>
          <td>{{ usuario.nombre_completo or '-' }}</td>
          <td>{{ usuario.email or '-' }}</td>
          <td>
            {% if usuario.es_admin %}
            <span style="padding:4px 8px; border-radius:4px; font-size:0.85em; background:#ff9800; color:white;">Admin</span>
            {% else %}
            <span style="padding:4px 8px; border-radius:4px; font-size:0.85em; background:#9e9e9e; color:white;">Usuario</span>
            {% endif %}
          </td>
          <td>
            {% if usuario.activo %}
            <span style="padding:4px 8px; border-radius:4px; font-size:0.85em; background:#d4edda; color:#155724;">Activo</span>
            {% else %}
            <span style="padding:4px 8px; border-radius:4px; font-size:0.85em; background:#f8d7da; color:#721c24;">Inactivo</span>
            {% endif %}
          </td>
          <td>
            {% if usuario.registro_completo %}
            <span style="padding:4px 8px; border-radius:4px; font-size:0.85em; background:#d4edda; color:#155724;">Completo</span>
            {% else %}
            <span style="padding:4px 8px; border-radius:4px; font-size:0.85em; background:#fff3cd; color:#856404;">Pendiente</span>
            {% endif %}
          </td>
          <td>{{ usuario.ultimo_acceso.strftime('%Y-%m-%d %H:%M') if usuario.ultimo_acceso else 'Nunca' }}</td>
          <td>
            <a href="{{ url_for('usuarios_editar', id=usuario.id) }}" class="button" style="padding:4px 8px; font-size:0.85em;">Editar</a>
            {% if usuario.username %}
            <a href="{{ url_for('usuarios_permisos', id=usuario.id) }}" class="button" style="padding:4px 8px; font-size:0.85em; background:#9c27b0;">Permisos</a>
            {% endif %}
          </td>
        </tr>
      {% endfor %}
    </table>
  {% else %}
    <p>No hay usuarios registrados.</p>
  {% endif %}
{% endblock %}

