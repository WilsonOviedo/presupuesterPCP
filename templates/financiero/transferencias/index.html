{% extends 'base.html' %}
{% block title %}Transferencias entre Cuentas{% endblock %}
{% block head %}
  <style>
    body {
      margin: 0 !important;
      padding: 0 !important;
    }
    .container {
      max-width: 100% !important;
      width: 100% !important;
      margin: 0 !important;
      padding: 0 !important;
    }
    .filtros-section {
      background: #f9f9f9;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .filtros-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 15px;
    }
    .form-group {
      display: flex;
      flex-direction: column;
    }
    .form-group label {
      font-weight: 600;
      margin-bottom: 5px;
      color: #555;
    }
    .form-group input,
    .form-group select {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }
    .transferencias-table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      border-radius: 8px;
      overflow: hidden;
    }
    .transferencias-table thead {
      background: linear-gradient(135deg, #9C27B0 0%, #7B1FA2 100%) !important;
      color: white !important;
    }
    .transferencias-table thead th {
      background: transparent !important;
      color: white !important;
    }
    .transferencias-table th {
      padding: 12px;
      text-align: left;
      font-weight: 600;
      font-size: 0.85em;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .transferencias-table td {
      padding: 10px 12px;
      border-bottom: 1px solid #e8e8e8;
      font-size: 0.85em;
    }
    .transferencias-table tbody tr {
      transition: background-color 0.2s ease;
    }
    .transferencias-table tbody tr:nth-child(even) {
      background: #fafafa;
    }
    .transferencias-table tbody tr:hover {
      background: #f3e5f5;
    }
    .paginacion {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 20px;
      padding: 15px;
      background: #f9f9f9;
      border-radius: 8px;
      flex-wrap: wrap;
      gap: 10px;
    }
    .paginacion-info {
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }
    .paginacion-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .paginacion-controls select {
      padding: 6px 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 0.9em;
    }
    .paginacion-buttons {
      display: flex;
      gap: 5px;
    }
    .paginacion-buttons a,
    .paginacion-buttons button {
      padding: 8px 12px;
      background: #9C27B0;
      color: white;
      text-decoration: none;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9em;
      transition: background 0.2s;
    }
    .paginacion-buttons a:hover,
    .paginacion-buttons button:hover {
      background: #7B1FA2;
    }
    .paginacion-buttons a:disabled,
    .paginacion-buttons button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
  </style>
{% endblock %}
{% block content %}
  <div style="padding: 20px;">
    <div style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
      <h2>üîÑ Transferencias entre Cuentas</h2>
      <a href="{{ url_for('transferencia_nuevo') }}" class="button" style="background: #9C27B0;">‚ûï Nueva Transferencia</a>
    </div>

    {% if error %}
    <div style="background: #fee; color: #c33; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #fcc;">
      <strong>Error:</strong> {{ error }}
    </div>
    {% endif %}

    {% if mensaje %}
    <div style="background: #efe; color: #3c3; padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #cfc;">
      <strong>√âxito:</strong> {{ mensaje }}
    </div>
    {% endif %}

    <div class="filtros-section">
      <h3>Filtros</h3>
      <form method="GET" action="{{ url_for('transferencias_index') }}">
        <div class="filtros-row">
          <div class="form-group">
            <label for="fecha_desde">Fecha desde:</label>
            <input type="date" id="fecha_desde" name="fecha_desde" value="{{ fecha_desde }}">
          </div>
          <div class="form-group">
            <label for="fecha_hasta">Fecha hasta:</label>
            <input type="date" id="fecha_hasta" name="fecha_hasta" value="{{ fecha_hasta }}">
          </div>
          <div class="form-group">
            <label for="banco_origen_id">Banco Origen:</label>
            <select id="banco_origen_id" name="banco_origen_id">
              <option value="">Todos</option>
              {% for banco in bancos %}
                <option value="{{ banco.id }}" {% if banco_origen_id == banco.id %}selected{% endif %}>
                  {{ banco.nombre }}
                </option>
              {% endfor %}
            </select>
          </div>
          <div class="form-group">
            <label for="banco_destino_id">Banco Destino:</label>
            <select id="banco_destino_id" name="banco_destino_id">
              <option value="">Todos</option>
              {% for banco in bancos %}
                <option value="{{ banco.id }}" {% if banco_destino_id == banco.id %}selected{% endif %}>
                  {{ banco.nombre }}
                </option>
              {% endfor %}
            </select>
          </div>
        </div>
        <div style="margin-top: 15px;">
          <button type="submit" class="button" style="background: #9C27B0;">üîç Buscar</button>
          <a href="{{ url_for('transferencias_index') }}" class="button button-secondary">Limpiar filtros</a>
        </div>
      </form>
    </div>

    <div style="overflow-x: auto;">
      <table class="transferencias-table">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Banco Origen</th>
            <th>Banco Destino</th>
            <th>Monto</th>
            <th>Descripci√≥n</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for transferencia in transferencias %}
            <tr>
              <td>{{ transferencia.fecha.strftime('%d/%m/%Y') if transferencia.fecha else '-' }}</td>
              <td><strong>{{ transferencia.banco_origen_nombre or '-' }}</strong></td>
              <td><strong>{{ transferencia.banco_destino_nombre or '-' }}</strong></td>
              <td style="text-align: right; font-weight: 600;">
                Gs {{ "{:,.2f}".format(transferencia.monto) }}
              </td>
              <td>{{ transferencia.descripcion or '-' }}</td>
              <td>
                <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                  <a href="{{ url_for('transferencia_editar', id=transferencia.id) }}" 
                     style="padding: 4px 8px; background: #9C27B0; color: white; text-decoration: none; border-radius: 4px; font-size: 0.8em;">‚úèÔ∏è Editar</a>
                  <form method="POST" action="{{ url_for('transferencia_eliminar', id=transferencia.id) }}" 
                        style="display: inline;" onsubmit="return confirm('¬øEst√° seguro de eliminar esta transferencia?');">
                    <button type="submit" style="padding: 4px 8px; background: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.8em;">üóëÔ∏è</button>
                  </form>
                </div>
              </td>
            </tr>
          {% endfor %}
          
          {% if not transferencias %}
            <tr>
              <td colspan="6" style="text-align: center; padding: 40px; color: #999;">
                No hay transferencias registradas. <a href="{{ url_for('transferencia_nuevo') }}">Crear primera transferencia</a>
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </div>

    {# Controles de paginaci√≥n #}
    {% if total_registros and total_registros > 0 %}
      <div class="paginacion">
        <div class="paginacion-info">
          <span>
            Mostrando {{ ((pagina - 1) * limite) + 1 }} - 
            {{ [pagina * limite, total_registros]|min }} de {{ total_registros }} registros
          </span>
          <span>
            P√°gina {{ pagina }} de {{ total_paginas }}
          </span>
        </div>
        <div class="paginacion-controls">
          <form method="GET" action="{{ url_for('transferencias_index') }}" style="display: flex; align-items: center; gap: 10px;">
            {% if request.args.get('fecha_desde') %}
              <input type="hidden" name="fecha_desde" value="{{ request.args.get('fecha_desde') }}">
            {% endif %}
            {% if request.args.get('fecha_hasta') %}
              <input type="hidden" name="fecha_hasta" value="{{ request.args.get('fecha_hasta') }}">
            {% endif %}
            {% if request.args.get('banco_origen_id') %}
              <input type="hidden" name="banco_origen_id" value="{{ request.args.get('banco_origen_id') }}">
            {% endif %}
            {% if request.args.get('banco_destino_id') %}
              <input type="hidden" name="banco_destino_id" value="{{ request.args.get('banco_destino_id') }}">
            {% endif %}
            <label style="font-size: 0.9em; font-weight: 600;">Filas por p√°gina:</label>
            <select name="limite" onchange="this.form.submit()" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.9em;">
              <option value="25" {% if limite == 25 %}selected{% endif %}>25</option>
              <option value="50" {% if limite == 50 %}selected{% endif %}>50</option>
              <option value="100" {% if limite == 100 %}selected{% endif %}>100</option>
              <option value="200" {% if limite == 200 %}selected{% endif %}>200</option>
            </select>
            <input type="hidden" name="pagina" value="1">
          </form>
        </div>
        <div class="paginacion-buttons">
          {% if pagina > 1 %}
            <a href="{{ url_for('transferencias_index', pagina=pagina-1, limite=limite, fecha_desde=request.args.get('fecha_desde', ''), fecha_hasta=request.args.get('fecha_hasta', ''), banco_origen_id=request.args.get('banco_origen_id', ''), banco_destino_id=request.args.get('banco_destino_id', '')) }}">
              ‚Üê Anterior
            </a>
          {% else %}
            <button disabled>‚Üê Anterior</button>
          {% endif %}
          
          {% if pagina < total_paginas %}
            <a href="{{ url_for('transferencias_index', pagina=pagina+1, limite=limite, fecha_desde=request.args.get('fecha_desde', ''), fecha_hasta=request.args.get('fecha_hasta', ''), banco_origen_id=request.args.get('banco_origen_id', ''), banco_destino_id=request.args.get('banco_destino_id', '')) }}">
              Siguiente ‚Üí
            </a>
          {% else %}
            <button disabled>Siguiente ‚Üí</button>
          {% endif %}
        </div>
      </div>
    {% endif %}
  </div>
{% endblock %}

